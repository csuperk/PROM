<div class="app-container">
  <header class="app-header">
    <h1>ğŸ“‹ Form2 Replier Demo with Smart on FHIR</h1>
    <p>æ•´åˆ FHIR ç—…æ‚£è³‡æ–™çš„è¡¨å–®å¡«å¯«çµ„ä»¶å±•ç¤º</p>
  </header>

  <!-- FHIR ç—…æ‚£è³‡è¨Šå€åŸŸ -->
  <section class="fhir-info-section" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9;">
    <h3>ğŸ¥ Smart on FHIR ç—…æ‚£è³‡è¨Š</h3>

    <!-- Smart Launch ç‹€æ…‹æª¢æŸ¥ -->
    <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
      <span *ngIf="isSmartLaunch()">ğŸš€ å¾ Smart on FHIR æ²™ç›’å•Ÿå‹•</span>
      <span *ngIf="!isSmartLaunch()">ğŸ’» ç›´æ¥å­˜å–æ¨¡å¼ï¼ˆä½¿ç”¨æ¨¡æ“¬è³‡æ–™ï¼‰</span>
    </div>

    <!-- è¼‰å…¥ç‹€æ…‹ -->
    <div *ngIf="fhirLoading" style="color: #666;">
      <i class="pi pi-spinner pi-spin"></i> è¼‰å…¥ FHIR è³‡æ–™ä¸­...
    </div>

    <!-- éŒ¯èª¤è¨Šæ¯ -->
    <div *ngIf="fhirError && !fhirLoading" style="color: #d32f2f; margin-bottom: 10px;">
      <i class="pi pi-exclamation-triangle"></i> {{ fhirError }}
      <button (click)="refreshFhirData()" style="margin-left: 10px; padding: 5px 10px;">é‡æ–°è¼‰å…¥</button>
    </div>

    <!-- ç—…æ‚£è³‡æ–™ -->
    <div *ngIf="patientData && !fhirLoading" class="patient-info">
      <h4>ğŸ‘¤ ç•¶å‰ç—…æ‚£</h4>
      <div style="background: white; padding: 10px; border-radius: 3px; margin-bottom: 10px;">
        <strong>æ‘˜è¦ï¼š</strong> {{ getPatientSummary() }}
      </div>

      <!-- è©³ç´°ç—…æ‚£è³‡æ–™ï¼ˆæ‘ºç–Šå¼ï¼‰ -->
      <details style="margin-bottom: 10px;">
        <summary style="cursor: pointer; font-weight: bold;">ğŸ” æŸ¥çœ‹å®Œæ•´ç—…æ‚£è³‡æ–™</summary>
        <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px;">{{ patientData.rawData | json }}</pre>
      </details>

      <!-- è—¥ç‰©è³‡æ–™ -->
      <div *ngIf="medicationData && medicationData.rawData && medicationData.rawData.length > 0">
        <h4>ğŸ’Š è—¥ç‰©è³‡è¨Š</h4>
        <details>
          <summary style="cursor: pointer; font-weight: bold;">ğŸ” æŸ¥çœ‹è—¥ç‰©æ¸…å–® ({{ medicationData.rawData.length }} é …)</summary>
          <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px;">{{ medicationData.rawData | json }}</pre>
        </details>
      </div>

      <!-- QuestionnaireResponse è³‡æ–™ -->
      <div *ngIf="questionnaireResponseData">
        <h4>ğŸ“ å•å·å›æ‡‰è³‡æ–™</h4>
        <div style="background: white; padding: 10px; border-radius: 3px; margin-bottom: 10px;">
          <strong>å•å·IDï¼š</strong> {{ questionnaireResponseData.id }}<br>
          <strong>ç‹€æ…‹ï¼š</strong> {{ questionnaireResponseData.status }}<br>
          <strong>å¡«å¯«æ™‚é–“ï¼š</strong> {{ questionnaireResponseData.authored | date:'yyyy-MM-dd HH:mm:ss' }}<br>
          <strong>é …ç›®æ•¸é‡ï¼š</strong> {{ questionnaireResponseData.item?.length || 0 }} é …
        </div>
        <details>
          <summary style="cursor: pointer; font-weight: bold;">ğŸ” æŸ¥çœ‹å®Œæ•´å•å·å›æ‡‰</summary>
          <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px;">{{ questionnaireResponseData | json }}</pre>
        </details>
      </div>

      <!-- Observation è³‡æ–™ -->
      <div *ngIf="observationData">
        <h4>ğŸ“Š è§€å¯Ÿè³‡æ–™ (BSRS-5 è©•åˆ†)</h4>
        <div style="background: white; padding: 10px; border-radius: 3px; margin-bottom: 10px;">
          <strong>è§€å¯ŸIDï¼š</strong> {{ observationData.id }}<br>
          <strong>ç‹€æ…‹ï¼š</strong> {{ observationData.status }}<br>
          <strong>è©•åˆ†ï¼š</strong> {{ observationData.valueQuantity?.value }} {{ observationData.valueQuantity?.unit }}<br>
          <strong>æ¸¬é‡æ™‚é–“ï¼š</strong> {{ observationData.effectiveDateTime | date:'yyyy-MM-dd HH:mm:ss' }}
        </div>
        <details>
          <summary style="cursor: pointer; font-weight: bold;">ğŸ” æŸ¥çœ‹å®Œæ•´è§€å¯Ÿè³‡æ–™</summary>
          <pre style="background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; font-size: 12px;">{{ observationData | json }}</pre>
        </details>
      </div>


      <!-- é‡æ–°è¼‰å…¥æŒ‰éˆ• -->
      <button
        (click)="refreshFhirData()"
        style="background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 3px; cursor: pointer;">
        ğŸ”„ é‡æ–°è¼‰å…¥ FHIR è³‡æ–™
      </button>
    </div>

    <!-- æ¨¡æ“¬è³‡æ–™æç¤º -->
    <div *ngIf="patientData && patientData.id === 'demo-patient-123'"
         style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 3px; margin-top: 10px;">
      <i class="pi pi-info-circle"></i>
      <strong>æ³¨æ„ï¼š</strong> ç›®å‰é¡¯ç¤ºçš„æ˜¯æ¨¡æ“¬è³‡æ–™ã€‚åœ¨çœŸå¯¦çš„ Smart on FHIR ç’°å¢ƒä¸­ï¼Œæ­¤è™•æœƒé¡¯ç¤ºå¯¦éš›çš„ç—…æ‚£è³‡æ–™ã€‚
    </div>
  </section>

  <!-- è¡¨å–®å€åŸŸ -->
  <main class="app-content">
    <h3>ğŸ“ è¡¨å–®å¡«å¯«</h3>
    <form2-replier
      [showTag]="true"
      [showToolbar]="true"
      [formReadOnly]="false"
      (result)="onFormResult($event)"
      (flagChange)="onFormChange($event)">
    </form2-replier>
  </main>
</div>
